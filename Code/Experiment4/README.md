# 实验四：跨链路的多机通信实验（网络层 - DV算法）

## 实验介绍
本实验在复杂网状拓扑（Mesh）中，利用 **Distance Vector (距离向量)** 路由算法实现多机动态路由通信。每台 PC 都是一个对等的路由器节点，能够自动发现邻居、计算全网路径，并对网络变化（如断线）做出反应。

## 核心算法
采用 **Bellman-Ford 方程** 进行路由更新：
$D_x(y) = \min_v \{ c(x,v) + D_v(y) \}$
- $D_x(y)$: 节点 x 到 节点 y 的开销
- $c(x,v)$: 节点 x 到 邻居 v 的开销 (本实验中固定为1)
- $D_v(y)$: 邻居 v 到 节点 y 的开销 (由邻居告知)

## 协议设计
通信协议定义在 `router.py` 中，采用文本格式：`TYPE|Field1|Field2...`
1. **邻居发现 (Hello)**: `HELLO|SenderID`
   - 每隔 3秒 广播一次，用于维持邻居关系。
   - 超过 10秒 未收到 Hello 视为邻居断开。
2. **路由通告 (DV)**: `DV|SenderID|JSON_Table`
   - 每隔 5秒 广播自己的路由表。
3. **数据传输 (Data)**: `DATA|SrcID|DstID|Payload`
   - 携带源与宿信息，沿途根据路由表逐跳转发。

## 使用说明

### 1. 硬件连接
任意连接各台电脑，形成网状结构（保证至少存在环路或多跳路径）。
确保每条连线是 **交叉线** (TX-RX)。

### 2. 启动程序
在每台电脑上运行：
```shell
python Code/Experiment4/router.py
```

### 3. 初始化配置
程序启动后会引导用户输入：
1. **本机ID**: 例如 `A`, `B`, `PC1`
2. **激活端口**: 输入要参与组网的串口列表，例如 `COM4` 或 `all`。

### 4. 操作指令
进入命令模式后，支持以下指令：
- **`table`** (或 `t`): 查看当前路由表（目的地址、跳数、下一跳、出口）。
- **`send <Dest> <Msg>`** (或 `s`): 向指定节点发送消息。
- **`exit`**: 退出程序。

### 5. 实验现象
- **收敛过程**: 启动后，节点会互相交换 Hello 和 DV 包。几秒钟后，使用 `table` 命令应能看到去往全网所有节点的路由。
- **断路测试**: 拔掉某根网线，等待约 10秒（超时判定），路由表应会自动更新，数据包会自动切换到备用路径（如果有）。
