# 实验部分

## Experiment 1 : 单机串口实验

-   这是实验主要是要在本机上实现一些基础的功能 从而检测自己的器材是否正确
-   实验的基本方式是在一台设备上把发送口和接受口相连 并完成下面的实验
-   主要设计了三个实验
    -   自己发送并接收消息
    -   测试最大传输能力
    -   发送并接收一个长文本 看是否会错漏 丢失信息
-   有一个重要的检查 就是检查硬件驱动 需要手动调节波特率刷新一下 这是硬件(或者官方驱动的问题 不是我们代码的问题)

```shell
conda create -n cnetwork python=3.11
conda activate cnetwork
pip install pyserial
```

```shell
python Code/Experiment1/main.py
```

## Experiment 2 : 双机通信实验

-   本实验主要是要在双机环境下实现C/S模式的通信 验证串口连接的可靠性
-   需要将两台设备通过串口交叉相连（TX接RX RX接TX）
-   实验包含两个独立程序 需要分别运行
    -   Server端：持续监听端口 解析请求并返回数据
    -   Client端：用户交互界面 发送指令并显示回显
-   请务必先启动Server端 再启动Client端 并在启动时选择正确的COM口

```shell
# Server Side
python Code/Experiment2/server.py
```

```shell
# Client Side
python Code/Experiment2/client.py
```

## Experiment 3 : 简单拓扑的多机通信实验（链路层）

-   本实验构建树形拓扑结构 (一根多叶) 实现链路层的数据转发
-   根节点 (Root PC) 充当交换中心 负责在叶子节点间转发数据
-   叶子节点 (Leaf PC) 只与根节点直连 通过根节点与其他节点通信
-   实验包含两个程序 需在不同设备运行
    -   Root端：管理转发表 监听多个端口 转发数据帧
    -   Leaf端：发送数据帧 接收数据帧
-   操作流程：
    1.  连接硬件：所有叶子节点交叉连接到根节点
    2.  启动Root端：按提示配置各个端口连接的设备ID
    3.  启动Leaf端：连接根节点并配置本机设备ID
    4.  测试通信：Leaf端输入 `目标ID 消息` 发送消息

```shell
# Root Node (ROOT)
python Code/Experiment3/root.py
```

```shell
# Leaf Node (PC...)
python Code/Experiment3/leaf.py
```

## Experiment 4 : 跨链路的多机通信实验（网络层 DV算法）

-   本实验在任意网状拓扑中实现动态路由
-   每台设备均运行相同的 DV (Distance Vector) 路由协议
-   支持自动邻居发现、路由表构建、断路重算
-   通用性设计：无需硬编码拓扑，只需指定本机ID和使用的串口

```shell
# 在每一台 PC 上运行
python Code/Experiment4/router.py
```
-   启动后操作：
    1.  输入本机ID (如 `A`, `B`, `PC1`)
    2.  选择使用的串口 (如 `COM4, COM5` 或 `all`)
    3.  等待几秒路由收敛 使用 `table` 查看路由表
    4.  使用 `send 目标ID 消息` 进行跨跳通信

## 实验五：多机可靠传输实验（运输层）
#### （一）实验目标
1. 理解运输层可靠传输的核心原理（停等协议、重传机制）；
2. 掌握数据校验、超时重传、确认机制的实现方法；
3. 实现多机间的无差错数据传输（支持模拟出错/超时场景）。

#### （二）实验器材
同实验四。

#### （三）实验软件
同实验一。

#### （四）实验步骤
1. **硬件连接**：
   - 沿用实验四的多链路拓扑（确保含2跳以上路径）；
   - 确认所有设备的COM口连接正常，链路通信稳定。
2. **软件调试**：
   - 使用串口调试助手模拟数据出错场景（手动修改发送数据），验证基础通信链路的容错性（未实现可靠传输时会出现数据错误）；
   - 模拟超时场景（断开某条链路后快速恢复），观察数据传输是否中断。
3. **程序编写**：
   - 基于实验四的路由功能，加入可靠传输机制（基于停等协议）；
   - 数据帧格式定义：帧头（源ID、目标ID、源端口、目标端口、帧序号、校验码、帧类型（数据/确认））+ 数据载荷；
   - 核心机制：
     - 数据校验：使用CRC32或奇偶校验计算校验码，接收端验证，校验失败则丢弃并请求重传；
     - 停等协议：发送端发送一帧后，等待接收端的确认帧（ACK），收到ACK后再发送下一帧；
     - 超时重传：发送端设置超时时间（如3秒），未在超时内收到ACK则自动重传该帧；
     - 确认机制：接收端正确接收数据帧后，立即发送对应序号的ACK帧；若接收重复帧，丢弃数据但重新发送ACK；
   - 模拟测试：手动触发数据出错（修改校验码）、超时（延迟发送ACK），验证程序是否能正确重传并接收正确数据。
4. **拓展任务**：
   - 滑动窗口协议实现：将停等协议扩展为滑动窗口（如窗口大小为3），支持连续发送多个帧后再等待ACK，提升传输效率；
   - 窗口大小优化：测试不同窗口大小（1~5）下的传输速率，确定最优窗口大小。

## 实验六：简单网络管理实验（应用层）
#### （一）实验目标
1. 理解ping和traceroute工具的核心原理；
2. 掌握应用层网络管理功能的实现方法；
3. 实现多机网络的可达性检测与路径追踪。

#### （二）实验器材
同实验四。

#### （三）实验软件
同实验一。

#### （四）实验步骤
1. **硬件连接**：
   - 沿用实验四的多链路拓扑；
   - 确保所有设备的路由功能正常（基于实验四实现）。
2. **软件调试**：
   - 使用Windows系统自带的ping命令（如ping 目标IP，实验中替换为设备ID）测试设备可达性；
   - 使用tracert命令（如tracert 目标IP）测试路径追踪，记录实际路径（跳数、设备ID）。
3. **程序编写**：
   - 基于实验四的路由功能和实验五的可靠传输机制，实现ping和traceroute功能；
   - ping功能实现：
     - 客户端（发起ping的设备）向目标设备发送ICMP回声请求帧（含请求标识、序列号、发送时间戳）；
     - 目标设备收到后，立即返回ICMP回声响应帧（携带相同标识和序列号、接收时间戳）；
     - 客户端计算往返时间（RTT=接收时间戳-发送时间戳），并统计丢包率（未收到响应的请求数/总请求数）；
     - 输出要求：显示目标设备是否可达、RTT平均值、丢包率。
   - traceroute功能实现：
     - 客户端向目标设备发送含TTL（生存时间）的测试帧，TTL初始值为1；
     - 每一跳设备收到帧后，TTL减1，若TTL=0则返回ICMP超时帧（包含自身ID）；
     - 客户端收到超时帧后，记录该跳设备ID，将TTL加1后继续发送测试帧；
     - 当测试帧到达目标设备时，目标设备返回ICMP响应帧，客户端停止测试并输出完整路径（所有跳数的设备ID）；
     - 输出要求：按跳数顺序显示路径中的设备ID、每跳的RTT。
4. **拓展任务**：
   - 批量ping测试：实现同时向多个目标设备发送ping请求，批量输出可达性结果；
   - traceroute路径优化：结合实验四的路由算法，显示最优路径与备选路径的追踪结果。